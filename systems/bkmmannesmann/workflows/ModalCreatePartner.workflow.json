{
    "identifier": "ModalCreatePartner",
    "title": "Modal to create a new user and client",
    "description": null,
    "async": false,
    "queue": null,
    "debug": false,
    "entry": "OpenCreatePartner",
    "elements": [
        {
            "name": "OpenCreatePartner",
            "type": "event/webhook",
            "options": {
                "async": false,
                "roles": null,
                "title": null,
                "module": null,
                "public": false
            },
            "in": {},
            "set": {},
            "to": {
                "default": {
                    "CreatePartnerModal": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    246.75681977234856,
                    -76.13173576460987
                ]
            }
        },
        {
            "name": "CreatePartnerModal",
            "type": "action/modal",
            "options": {
                "hard": false,
                "type": "confirm",
                "title": "",
                "fields": [],
                "layout": "create_partner.modal",
                "checkpoint": true,
                "autosave_key": null
            },
            "in": {},
            "set": {
                "partnerData": "confirm:"
            },
            "to": {
                "confirm": {
                    "CheckForMail": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    582.7452185858524,
                    -71.69797108273286
                ]
            }
        },
        {
            "name": "ValidateData",
            "type": "action/validate",
            "options": {
                "recipes": {
                    "email": "$user.length == 0 && $partnerData.email",
                    "password": "$partnerData.password"
                },
                "runModuleValidations": false,
                "markFailedFields": true
            },
            "in": {
                "default": "$partnerData"
            },
            "set": {},
            "to": {
                "valid": {
                    "GetRole": [
                        "default"
                    ]
                },
                "invalid": {
                    "NotifyError": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    1347.753445482333,
                    -124.31920772220434
                ]
            }
        },
        {
            "name": "NotifyError",
            "type": "action/notify",
            "options": {
                "notification": {
                    "recipients": null,
                    "title": null,
                    "message": null,
                    "entity": null,
                    "type": null,
                    "icon": null,
                    "icon-color": null,
                    "image": null,
                    "actions": null
                },
                "toast": {
                    "message": "Fehler",
                    "description": {
                        ".recipe": "$user.length ? \"E-Mail Adresse bereits vergeben\" : \"Es wurden nicht alle Felder ausgef√ºllt\""
                    },
                    "type": "error",
                    "duration": 4.5
                },
                "mail": {
                    "to": null,
                    "cc": null,
                    "bcc": null,
                    "from": null,
                    "subject": null,
                    "attachments": null
                },
                "sms": {
                    "to": null,
                    "from": null,
                    "body": null
                }
            },
            "in": {},
            "set": {},
            "to": {},
            "meta": {
                "position": [
                    1706.2094122446892,
                    101.66592091601024
                ]
            }
        },
        {
            "name": "CheckForMail",
            "type": "source/entities",
            "options": {
                "module": "users",
                "listItems": null,
                "filters": [
                    [
                        {
                            "left": {
                                "type": "field",
                                "value": "email"
                            },
                            "operator": "=",
                            "right": {
                                "type": "recipe",
                                "value": "$partnerData.email"
                            }
                        }
                    ]
                ],
                "with": [],
                "fields": [],
                "groupBy": [],
                "orderBy": [],
                "having": [],
                "limit": null,
                "offset": null,
                "first": false,
                "scopes": [],
                "permissions": false,
                "withTrashed": false,
                "global": true,
                "autoDistinct": true,
                "distinct": false
            },
            "in": {},
            "set": {
                "user": "default:"
            },
            "to": {
                "default": {
                    "ValidateData": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    982.6976668111097,
                    -77.487239014807
                ]
            }
        },
        {
            "name": "NewClient",
            "type": "source/new",
            "options": {
                "module": "clients",
                "values": null,
                "client": null
            },
            "in": {},
            "set": {},
            "to": {
                "default": {
                    "ClientData": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    2558.2202336117525,
                    -135.13442831435282
                ]
            }
        },
        {
            "name": "ClientData",
            "type": "op/set",
            "options": {
                "copy": null,
                "values": [],
                "process": false,
                "recipes": {
                    "title": "\"UserClient-\" + $newUser.email",
                    "global": "0",
                    "hostnames": "[$newUser.id + \"-\" + slugify($newUser.email)]"
                }
            },
            "in": {},
            "set": {},
            "to": {
                "default": {
                    "SaveClient": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    2907.7023391856333,
                    -122.6606330276214
                ]
            }
        },
        {
            "name": "NewUser",
            "type": "source/new",
            "options": {
                "module": "users",
                "values": null,
                "client": null
            },
            "in": {},
            "set": {},
            "to": {
                "default": {
                    "UserData": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    2126.2514852144413,
                    -273.98747354994623
                ]
            }
        },
        {
            "name": "UserData",
            "type": "op/set",
            "options": {
                "copy": null,
                "recipes": {
                    "email": "$partnerData.email",
                    "password": "$partnerData.password",
                    "name": "$partnerData.name",
                    "roles": "$partnerRole"
                },
                "values": [],
                "process": true
            },
            "in": {},
            "set": {},
            "to": {
                "default": {
                    "SaveUser": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    2446.970964323911,
                    -379.0674039696864
                ]
            }
        },
        {
            "name": "GetRole",
            "type": "source/entities",
            "options": {
                "module": "roles",
                "listItems": null,
                "filters": [
                    [
                        {
                            "left": {
                                "type": "field",
                                "value": "slug"
                            },
                            "operator": "=",
                            "right": {
                                "type": "recipe",
                                "value": "\"partner\""
                            }
                        }
                    ]
                ],
                "with": [],
                "fields": [],
                "groupBy": [],
                "orderBy": [],
                "having": [],
                "limit": null,
                "offset": null,
                "first": false,
                "scopes": [],
                "permissions": false,
                "withTrashed": false,
                "global": false,
                "autoDistinct": true,
                "distinct": false
            },
            "in": {},
            "set": {
                "partnerRole": "default:"
            },
            "to": {
                "default": {
                    "NewUser": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    1724.5230509846197,
                    -239.4472791330341
                ]
            }
        },
        {
            "name": "SaveUser",
            "type": "action/save",
            "options": {
                "triggerEvents": false,
                "skip_recipes": false,
                "continueIfInvalid": false
            },
            "in": {},
            "set": {
                "newUser": "default:"
            },
            "to": {
                "default": {
                    "NewClient": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    2746.9370179946,
                    -388.54948159718487
                ]
            }
        },
        {
            "name": "SaveClient",
            "type": "action/save",
            "options": {
                "triggerEvents": false,
                "skip_recipes": false,
                "continueIfInvalid": false
            },
            "in": {},
            "set": {
                "client": "default:"
            },
            "to": {
                "default": {
                    "AddClientToUser": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    3195.2670186042096,
                    -115.25998605754387
                ]
            }
        },
        {
            "name": "AddClientToUser",
            "type": "op/set",
            "options": {
                "copy": null,
                "values": [],
                "process": false,
                "recipes": {
                    "client": "$client"
                }
            },
            "in": {
                "default": "$newUser"
            },
            "set": {},
            "to": {
                "default": {
                    "UpdateUser": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    2673.129655437717,
                    133.52340005042078
                ]
            }
        },
        {
            "name": "UpdateUser",
            "type": "action/save",
            "options": {},
            "in": {},
            "set": {},
            "to": {},
            "meta": {
                "position": [
                    3007.8500290224265,
                    159.7499604251669
                ]
            }
        }
    ],
    "events": [
        {
            "identifier": "OpenCreatePartner",
            "type": "webhook",
            "module": null,
            "async": false,
            "roles": null,
            "title": null,
            "public": false
        }
    ],
    "comments": []
}
