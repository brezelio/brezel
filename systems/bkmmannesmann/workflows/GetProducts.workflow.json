{
    "identifier": "GetProducts",
    "title": "Get Products for create order",
    "description": null,
    "async": false,
    "queue": null,
    "debug": false,
    "entry": "GetProductsSource",
    "elements": [
        {
            "name": "GetProductsSource",
            "type": "source/entities",
            "options": {
                "with": [
                    "image",
                    "parent",
                    "product_category"
                ],
                "first": false,
                "limit": null,
                "fields": [],
                "global": false,
                "having": [],
                "module": "products",
                "offset": null,
                "scopes": [],
                "filters": [
                    [
                        {
                            "left": {
                                "type": "field",
                                "value": "product_category.name"
                            },
                            "operator": "LIKE",
                            "right": {
                                "type": "recipe",
                                "value": "\"%\" + $categorieName + \"%\""
                            }
                        }
                    ]
                ],
                "groupBy": [],
                "orderBy": [],
                "distinct": false,
                "listItems": null,
                "permissions": false,
                "withTrashed": false,
                "autoDistinct": true
            },
            "in": {},
            "set": {
                "products": "default:"
            },
            "to": {
                "default": {
                    "new-fox-29": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    473.3642364747114,
                    70.17001547543344
                ]
            }
        },
        {
            "name": "GetProducts",
            "type": "event/webhook",
            "options": {
                "module": null,
                "title": null,
                "async": false,
                "roles": null,
                "public": false
            },
            "in": {},
            "set": {
                "request": "request:"
            },
            "to": {
                "default": {
                    "GetDefaultCat": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    -713.6877798061546,
                    76.47334550921822
                ]
            }
        },
        {
            "name": "SetResponse",
            "type": "op/recipe",
            "options": {
                "recipe": "{\"products\": $array}"
            },
            "in": {},
            "set": {},
            "to": {
                "default": {
                    "Response": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    2181.4877040355477,
                    164.9438869741731
                ]
            }
        },
        {
            "name": "Response",
            "type": "action/response",
            "options": {},
            "in": {},
            "set": {},
            "to": {},
            "meta": {
                "position": [
                    2564.5858226295663,
                    18.422931773507738
                ]
            }
        },
        {
            "name": "new-fox-29",
            "type": "flow/each",
            "options": {},
            "in": {},
            "set": {
                "product": "each:"
            },
            "to": {
                "each": {
                    "cowardly-grasshopper-57": [
                        "default"
                    ]
                },
                "next": {
                    "RemoveChilds": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    814.2070135516327,
                    -44.27989488457861
                ]
            }
        },
        {
            "name": "cowardly-grasshopper-57",
            "type": "flow/if",
            "options": {
                "condition": "$product.product_type == \"group\""
            },
            "in": {},
            "set": {},
            "to": {
                "default": {
                    "plastic-crab-15": [
                        "default"
                    ]
                },
                "else": {
                    "rude-chicken-68": [
                        "item"
                    ]
                }
            },
            "meta": {
                "position": [
                    1134.8300810048324,
                    -99.94249967606716
                ]
            }
        },
        {
            "name": "plastic-crab-15",
            "type": "op/recipe",
            "options": {
                "recipe": "$product.map(p => {...p, \"childs\": $products.filter(el => el.parent.id == p.id) })[0]"
            },
            "in": {},
            "set": {
                "product": "default:"
            },
            "to": {
                "default": {
                    "rude-chicken-68": [
                        "item"
                    ]
                }
            },
            "meta": {
                "position": [
                    1464.5241138774757,
                    -231.37901957302108
                ]
            }
        },
        {
            "name": "InitArray",
            "type": "op/recipe",
            "options": {
                "recipe": "[]"
            },
            "in": {},
            "set": {
                "array": "default:"
            },
            "to": {
                "default": {
                    "GetProductsSource": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    98.9692434250399,
                    132.4908137121681
                ]
            }
        },
        {
            "name": "rude-chicken-68",
            "type": "op/push",
            "options": {},
            "in": {
                "array": "$array"
            },
            "set": {
                "array": "default:"
            },
            "to": {},
            "meta": {
                "position": [
                    1886.7032321738009,
                    -244.0986490509132
                ]
            }
        },
        {
            "name": "RemoveChilds",
            "type": "op/recipe",
            "options": {
                "recipe": "$array.filter(el => el.parent == null)"
            },
            "in": {},
            "set": {
                "array": "default:"
            },
            "to": {
                "default": {
                    "SetResponse": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    1219.9176271792292,
                    185.57357158254493
                ]
            }
        },
        {
            "name": "GetDefaultCat",
            "type": "op/recipe",
            "options": {
                "recipe": "$request.categorie.name ? $request.categorie.name : \"Bestseller\""
            },
            "in": {},
            "set": {
                "categorieName": "default:"
            },
            "to": {
                "default": {
                    "InitArray": [
                        "default"
                    ]
                }
            },
            "meta": {
                "position": [
                    -255.40103125210425,
                    132.81531059358412
                ]
            }
        }
    ],
    "events": [
        {
            "identifier": "GetProducts",
            "type": "webhook",
            "module": null,
            "title": null,
            "async": false,
            "roles": null,
            "public": false
        }
    ],
    "comments": []
}
