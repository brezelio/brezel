[
  {
    "resource_module": "invoices",
    "resource": {
      "identifier": "invoices",
      "title": "invoice_number",
      "icon": "bank",
      "layouts": {
        "detail": "${file('/config/invoices/invoices.detail.json')}",
        "index": "${file('/config/invoices/invoices.index.json')}"
      },
      "buttons": {
        "print": {
          "display": false
        },
        "generate_PDF": {
          "trigger": "GenerateInvoicePDFWebhook",
          "hidden": true,
          "icon": "file-pdf",
          "style": "primary",
          "show_in": ["module.show"]
        }
      },
      "fields": [
        {
          "identifier": "process",
          "type": "select",
          "options": {
            "references": "processes",
            "rules": "required"
          }
        },
        {
          "identifier": "invoice_number",
          "type": "incrementing",
          "options": {
            "incrementing_default": 0,
            "incrementing_format": "TEXT%INV-|DATE%Y|DATE%m|TEXT%-|INCREMENTING_VALUE%3"
          }
        },
        {
          "identifier": "invoice_date",
          "type": "date",
          "options": {
            "fullDay": true,
            "default": "NOW",
            "recipes": {
              "default": "date()"
            }
          }
        },
        {
          "identifier": "project",
          "type": "select",
          "options": {
            "references": "projects"
          }
        },
        {
          "identifier": "customer",
          "type": "select",
          "options": {
            "references": "customers"
          }
        },
        {
          "identifier": "type",
          "type": "choice",
          "options": {
            "values": ["partial", "final"]
          }
        },
        {
          "identifier": "status",
          "type": "choice",
          "options": {
            "values": ["open", "paid"]
          }
        },
        {
          "identifier": "address",
          "type": "text"
        },
        {
          "identifier": "zip",
          "type": "text"
        },
        {
          "identifier": "city",
          "type": "text"
        },
        {
          "identifier": "phone",
          "type": "tel"
        },
        {
          "identifier": "positions",
          "type": "list",
          "options": {
            "show_ordering": true,
            "mode": "tabs",
            "title_field": "headline",
            "fields": [
              {
                "identifier": "headline",
                "type": "text",
                "options": {
                  "hidden_from_frontend": true
                }
              },
              {
                "identifier": "sec_pos",
                "type": "list",
                "options": {
                  "show_ordering": true,
                  "fields": [
                    {
                      "identifier": "service",
                      "type": "select",
                      "options": {
                        "references": "services",
                        "events": {
                          "on_change": ["OnChangeService"]
                        }
                      }
                    },

                    {
                      "identifier": "description",
                      "type": "textarea",
                      "options": {
                        "fullscreenButton": true,
                        "list_item_min_width": "200px"
                      }
                    },
                    {
                      "identifier": "quantity",
                      "type": "number",
                      "options": {
                        "decimal_digits": 3
                      }
                    },
                    {
                      "identifier": "unit",
                      "type": "select",
                      "options": {
                        "references": "product_units",
                        "table_select": false,
                        "list_item_max_width": "150px"
                      }
                    },
                    {
                      "identifier": "single_price",
                      "type": "currency"
                    },
                    {
                      "identifier": "total_price",
                      "type": "currency",
                      "recipe": "(single_price * quantity)"
                    }
                  ]
                }
              },
              {
                "identifier": "use_subtotal",
                "type": "checkbox",
                "options": {
                  "hidden_from_frontend": true,
                  "dev_comment_remove_this": "as far as i can see, this has no usage? I'm hiding it for now. -Sebastian"
                }
              },
              {
                "identifier": "subtotal",
                "type": "currency",
                "recipe": "round(sum(sec_pos[*].total_price) * 100) / 100"
              }
            ]
          }
        },
        {
          "identifier": "taxrate",
          "type": "number",
          "options": {
            "default": 19,
            "readonly": true,
            "suffix": "%"
          }
        },
        {
          "identifier": "tax_amount",
          "type": "currency",
          "recipe": "(price_net* (taxrate / 100))"
        },
        {
          "identifier": "price_net",
          "type": "currency",
          "recipe": "sum(positions[*].subtotal)"
        },
        {
          "identifier": "price_total",
          "type": "currency",
          "recipe": "price_net+(price_net* (taxrate / 100))"
        },
        {
          "identifier": "project_amount",
          "type": "currency",
          "options": {
            "readonly": true
          }
        },
        {
          "identifier": "previously_invoiced",
          "type": "currency",
          "options": {
            "readonly": true
          }
        },
        {
          "identifier": "partial_pay",
          "type": "currency",
          "options": {
            "readonly": true
          }
        },
        {
          "identifier": "tax_portion",
          "type": "currency",
          "options": {
            "readonly": true
          }
        },
        {
          "identifier": "invoice_open_position",
          "type": "currency",
          "options": {
            "readonly": true
          }
        }
      ]
    }
  },
  {
    "resource_layout": "project_to_invoice.modal",
    "resource": {
      "identifier": "project_to_invoice.modal",
      "spec": "${jsonFile('config/modals/project_to_invoice.modal.json', true)}"
    }
  }
]
