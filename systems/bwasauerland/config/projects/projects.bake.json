[
  {
    "resource_module": "projects",
    "import": true,
    "resource": {
      "identifier": "projects",
      "icon": "container",
      "title": "project_number",
      "layouts": {
        "detail": "${file('config/projects/projects.detail.json')}"
      },
      "buttons": {
        "create_invoice": {
          "hidden": true,
          "icon": "container",
          "trigger": "ProjectsToInvoiceWebhook",
          "style": "primary",
          "show_in": ["module.show"]
        },
        "generate_partial_invoice": {
          "hidden": true,
          "icon": "bank",
          "trigger": "GeneratePartialInvoiceWebhook",
          "style": "primary",
          "show_in": ["module.show"]
        },
        "create_additional_service": {
          "hidden": true,
          "icon": "bank",
          "trigger": "CreateAdditionalService",
          "style": "primary",
          "show_in": ["module.show"]
        }
      },
      "fields": [
        {
          "identifier": "project_number",
          "type": "incrementing",
          "options": {
            "incrementing_format": "TEXT%PRO-|DATE%Y|DATE%m|TEXT%-|INCREMENTING_VALUE%3"
          }
        },
        {
          "identifier": "process",
          "type": "select",
          "options": {
            "rules": "required",
            "references": "processes"
          }
        },
        {
          "identifier": "customer",
          "type": "select",
          "options": {
            "references": "customers",
            "rules": "required"
          }
        },
        {
          "identifier": "object",
          "type": "select",
          "options": {
            "references": "objects",
            "rules": "required"
          }
        },
        {
          "identifier": "start_date",
          "type": "date"
        },
        {
          "identifier": "end_date",
          "type": "date"
        },
        {
          "identifier": "total_worktime",
          "type": "number"
        },
        {
          "identifier": "status",
          "type": "choice",
          "options": {
            "values": ["planned", "in_progress", "finished"]
          }
        },
        {
          "identifier": "problem",
          "type": "select",
          "options": {
            "references": "problems",
            "rules": "required"
          }
        },
        {
          "identifier": "room_temperature",
          "type": "number"
        },
        {
          "identifier": "room_humidity",
          "type": "number"
        },
        {
          "identifier": "surface_temperature",
          "type": "number"
        },
        {
          "identifier": "construction_year",
          "type": "text"
        },
        {
          "identifier": "wall_material",
          "type": "text"
        },
        {
          "identifier": "wall_thickness",
          "type": "number"
        },
        {
          "identifier": "building_type",
          "type": "select",
          "options": {
            "references": "building_types"
          }
        },
        {
          "identifier": "level",
          "type": "text"
        },
        {
          "identifier": "floor_material",
          "type": "text"
        },
        {
          "identifier": "strip_foundation",
          "type": "text"
        },
        {
          "identifier": "seals_done_in_the_past",
          "type": "checkbox"
        },
        {
          "identifier": "services",
          "options": {
            "show_ordering": true,
            "fields": [
              {
                "identifier": "service",
                "type": "select",
                "options": {
                  "references": "services",
                  "add_options": true,
                  "events": {
                    "on_change": ["OnChangeService"]
                  }
                }
              },
              {
                "identifier": "description",
                "type": "text"
              },
              {
                "identifier": "single_price",
                "type": "currency",
                "options": {
                  "readonly": false
                }
              },
              {
                "identifier": "quantity_type",
                "type": "choice",
                "options": {
                  "values": [
                    "hourly",
                    "flat_price"
                  ]
                }
              },
              {
                "identifier": "quantity",
                "type": "number",
                "options": {
                  "decimal_digits": 2,
                  "min": 1
                }
              },
              {
                "identifier": "total_price",
                "type": "currency",
                "recipe": "single_price * quantity"
              }
            ]
          },
          "type": "list"
        },
        {
          "identifier": "taxrate",
          "type": "number",
          "options": {
            "readonly": true,
            "default": 19
          }
        },
        {
          "identifier": "price_net",
          "type": "currency",
          "recipe": "sum(services[*].total_price)"
        },
        {
          "identifier": "price_total",
          "type": "currency",
          "recipe": "price_net+(price_net* (taxrate / 100))"
        },
        {
          "identifier": "previously_invoiced",
          "type": "currency",
          "options": {
            "recipes": {
              "frontend_disabled": "false"
            },
            "events": {
              "on_load": ["CalculateInvoicedAmount"]
            }
          }
        },
        {
          "identifier": "invoice_open_position",
          "type": "currency",
          "recipe": "round((price_total - previously_invoiced)*100)/100"
        }
      ]
    }
  },
  {
    "resource_layout": "offer_to_project_modal",
    "resource": {
      "identifier": "offer_to_project.modal",
      "spec": "${jsonFile('config/modals/offer_to_project.modal.json', true)}"
    }
  },
  {
    "resource_layout": "partial_invoice_in_project_modal",
    "resource": {
      "identifier": "partial_invoice_in_project.modal",
      "spec": "${jsonFile('config/modals/partial_invoice_in_project.modal.json', true)}"
    }
  },
  {
    "resource_layout": "create_additional_service_modal",
    "resource": {
      "identifier": "create_additional_service.modal",
      "spec": "${jsonFile('config/modals/create_additional_service.modal.json', true)}"
    }
  }
]
